

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>base_model Module Documentation &mdash; rf_classifier 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="mya Module Documentation" href="mya.html" />
    <link rel="prev" title="Pluggable Model API Introduction" href="intro.html" />
    <link href="../../_static/rtd_custom.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> rf_classifier
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin_guide/index.html">Admin Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">base_model Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-base_model">base_model Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mya.html">mya Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">utils Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Relase Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Links</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rf_classifier</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Pluggable Model API Documentation</a> &raquo;</li>
        
      <li>base_model Module Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/dev_guide/api/base_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="base-model-module-documentation">
<h1>base_model Module Documentation<a class="headerlink" href="#base-model-module-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This module defines the model interface expected by the rfClassifier application.  Specifically, the base_model class
enforces that two methods, describe() and analyze(), are defined.  See their documentation below.</p>
<p>Additional methods are provided that ease the process of parsing and validating RF fault event directories.</p>
</div>
<div class="section" id="module-base_model">
<span id="base-model-class"></span><h2>base_model Class<a class="headerlink" href="#module-base_model" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="base_model.BaseModel">
<em class="property">class </em><code class="descclassname">base_model.</code><code class="descname">BaseModel</code><span class="sig-paren">(</span><em>event_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract class defining the model API and providing several useful concrete functions.</p>
<p>Inheriting from this class requires that both the describe and analzye methods be defined which form the basis of
the model API.  This class provides a number of concrete methods that can be used to perform data processing and
validation.  Child classes may use these directly or as a guide for writing their own.</p>
<dl class="attribute">
<dt id="base_model.BaseModel.event_dir">
<code class="descname">event_dir</code><a class="headerlink" href="#base_model.BaseModel.event_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>The path to the event directory being analyzed by this model object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="base_model.BaseModel.event_df">
<code class="descname">event_df</code><a class="headerlink" href="#base_model.BaseModel.event_df" title="Permalink to this definition">¶</a></dt>
<dd><p>A Pandas dataframe containing the parsed waveform data from event_dir.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">pandas.dataframe</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.analyze">
<em class="property">abstract </em><code class="descname">analyze</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.analyze" title="Permalink to this definition">¶</a></dt>
<dd><p>A method that performs some analysis and classifies the fault event by cavity number and fault type.</p>
<p>This method is the most important part of any model package.  Here is where the desired analytical
approaches should be implemented.  In addition to the classification label output, this method should
include information about the confidence of those classifications and list which fault event is being
analyzed.  Confidence numbers should be given on the range [0,1] with lower numbers implying more
uncertainty and higher numbers implying greater certainty.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A dictionary containing the results of the analysis.  Detailed key/value information given in the table below.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils align-default">
<colgroup>
<col width="21%" />
<col width="12%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Value Type</th>
<th class="head">Value Descriptions</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>“location”</td>
<td>str</td>
<td>Zone of the fault event. (e.g. “1L22”)</td>
</tr>
<tr class="row-odd"><td>“timestamp”</td>
<td>str</td>
<td>Timestamp of the fault event, (e.g. “2019-12-25 01:23:45.6”)</td>
</tr>
<tr class="row-even"><td>“cavity-label”</td>
<td>str</td>
<td>Label of the cavity that faulted (e.g., “cav1”)</td>
</tr>
<tr class="row-odd"><td>“cavity-confidence”</td>
<td>float</td>
<td>Number between [0,1] representing cavity label confidence</td>
</tr>
<tr class="row-even"><td>“fault-label”</td>
<td>str</td>
<td>Label of the identified fault type (e.g., quench)</td>
</tr>
<tr class="row-odd"><td>“fault-confidence”</td>
<td>float</td>
<td>Number between [0,1] representing fault type label confidence</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.get_event_df">
<code class="descname">get_event_df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.get_event_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Accessor method for class attribute event_df.</p>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.is_capture_file">
<code class="descname">is_capture_file</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.is_capture_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Validates if filename appears to be a valid capture file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<em>str</em>) – The name of the file that is to be validated</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the filename appears to be a valid capture file.  Otherwise False.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.parse_capture_file">
<code class="descname">parse_capture_file</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.parse_capture_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses an individual capture file into a Pandas dataframe object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> – The name of the file, , relative to event_dir, to be parsed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A pandas dataframe containing the data from the specified capture file</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dataframe</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.parse_event_dir">
<code class="descname">parse_event_dir</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.parse_event_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the  capture files in the BaseModel’s event_dir and sets event_df to the appropriate pandas dataframe.</p>
<p>The waveform names are converted from &lt;EPICS_NAME&gt;&lt;Waveform&gt; (e.g., R123WFSGMES), to &lt;Cavity_Number&gt;_&lt;Waveform&gt;
(e.g., 3_GMES).  This allows analysis code to more easily handle waveforms from different zones.</p>
<blockquote>
<div><dl class="docutils">
<dt>Returns:</dt><dd>None</dd>
<dt>Raises:</dt><dd>ValueError: if a column name is discovered with an unexpected format</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.validate_capture_file_counts">
<code class="descname">validate_capture_file_counts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.validate_capture_file_counts" title="Permalink to this definition">¶</a></dt>
<dd><p>This method checks that we have exactly one capture file per cavity/IOC.</p>
<p>The harvester grouping logic coupled with unreliable IOC behavior seems to produce fault event directories where
either an IOC has multiple capture files or are missing.  We want to make sure we have exactly eight capture
files - one per IOC.  Raises an exception in the case that something is amiss.</p>
<blockquote>
<div><dl class="docutils">
<dt>Returns:</dt><dd>None</dd>
<dt>Raises:</dt><dd>ValueError: if either missing or “duplicate” capture files are found.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.validate_capture_file_waveforms">
<code class="descname">validate_capture_file_waveforms</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.validate_capture_file_waveforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that all of the required waveforms are present exactly one time across all capture files.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><strong>ValueError</strong> – if any required waveform is repeated</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.validate_cavity_modes">
<code class="descname">validate_cavity_modes</code><span class="sig-paren">(</span><em>mode=4</em>, <em>offset=-1.0</em><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.validate_cavity_modes" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that each cavity was in the appropriate control mode.</p>
<p>A request is made to the internal CEBAF myaweb myquery HTTP service at the specified offset from the event
timestamp.  Currently the proper mode is GDR (I/Q).</p>
<p>According to the RF low-level software developer (lahti), the proper PV for C100 IOCs is
R&lt;Linac&gt;&lt;Zone&gt;&lt;Cavity&gt;CNTL2MODE which is a float treated like a bitword.  At the time of writing, the most
common modes are:</p>
<ul class="simple">
<li>2 == SEL</li>
<li>4 == GDR (I/Q)</li>
</ul>
<p>A single cavity may be bypassed by operations to alleviate performance problems.  In the situation the rest of
the zone is working normally and is considered to produce valid data for modeling purposes.  Only the control
modes of the non-bypassed cavities will be considered for invalidating the data.</p>
<blockquote>
<div><dl class="docutils">
<dt>Args:</dt><dd>mode (int):  The mode number associated with the proper control mode.
offset (float): The number of seconds before the fault event the mode setting should be checked.</dd>
<dt>Returns:</dt><dd>None</dd>
<dt>Raises:</dt><dd>ValueError: if any cavity mode does not match the value specified by the mode parameter.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="base_model.BaseModel.validate_waveform_times">
<code class="descname">validate_waveform_times</code><span class="sig-paren">(</span><em>time_limits=(-1600</em>, <em>1600)</em>, <em>delta_max=0.025</em><span class="sig-paren">)</span><a class="headerlink" href="#base_model.BaseModel.validate_waveform_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the Time column of all capture files are identical and have a valid range and sample interval.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>time_limits</strong> (<em>tuple</em>) – A two-valued tuple (min_t, max_t) which gives the minimum and maximum time values
that are allowed for a valid waveform.  Values in milliSeconds.</li>
<li><strong>delta_max</strong> (<em>float</em>) – The maximum difference between the smallest and largest time steps in milliseconds.
(default is 0.025)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">None</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><strong>ValueError</strong> – if either Time columns mismatch or Time columns are beyond expected thresholds</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mya.html" class="btn btn-neutral float-right" title="mya Module Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral float-left" title="Pluggable Model API Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Adam Carpenter

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>